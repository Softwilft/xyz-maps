/*
 * @here/xyz-maps-common
 * (c) 2019-2022 HERE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).here=t.here||{},t.here.xyz=t.here.xyz||{},t.here.xyz.maps=t.here.xyz.maps||{},t.here.xyz.maps.common={}))}(this,(function(t){"use strict";var e="undefined"!=typeof window?window:global,n=0,r=function(){function t(t,e,r,i,o,a,s,u){this.id=++n,this.exec=r,i&&(this.init=i),this.delay=0^u,this.name=s,this.time=o||100,this.priority=Math.max(Math.min(0^e,5),1),this.manager=t,a&&(this.onDone=a)}return t.prototype.start=function(t){var e=this;return e._data=t,e.manager.start(e)},t.prototype.pause=function(){return this.paused=!0,this.CONTINUE},t.prototype.resume=function(){this.paused=!1,this.start(this._data)},t.prototype.restart=function(t){void 0===t&&(t={});var e=this._data;this.cancel(),this.paused=!1,this.canceled=!1,this.yield=!1,this.delayed=null,this.heap=null,this._data=e,t.init&&(this.init=t.init),t.priority&&(this.priority=t.priority),t.onDone&&(this.onDone=t.onDone),this.start()},t.prototype.init=function(t){return t},t.prototype.cancel=function(){var t=this;return t._data=null,t.manager.cancel(t)},t}();r.prototype.CONTINUE=!0,r.prototype.BREAK=!1,r.prototype.onDone=null,r.prototype.heap=null,r.prototype.yield=!1,r.prototype.delayed=null,r.prototype.canceled=!1;var i,o,a=1e3/60,s=0,u=function(){function t(t){this.time=a,this._delayed=null,this.now=Date.now;var n=this;if(n.queue=[[],[],[],[],[],[]],n.id=s++,n.active=!1,t>1&&(n.time=t||a),e.postMessage){var r="tm-"+n.id;e.addEventListener("message",(function(t){t.source==e&&t.data==r&&(t.stopPropagation(),n.runner())}),!0),n._resume=function(){n.active=!0,e.postMessage(r,"*")}}else n._resume=function(){n.active=!0,setTimeout(n.runner.bind(n),0)}}return t.prototype.runner=function(t){var e,n,r,i,o,a,s,u,h,c=this,l=!0;if(t=t||c.now(),c.active){for(;(l=c.now()-t<c.time)&&(c.task=s=c._next());){for(r=!1,u=!1,s.yield?(s.yield=!1,h=s.heap):(i=c.now(),h=s.init(s._data));!u;)if(o=i||c.now(),u=!s.exec(h)||s.canceled,n=(a=c.now())-o,i=null,e=a-t>c.time,c.task=null,s.paused&&(u=!0,e=!1,r=!0,s.heap=h,s.started=!1,s.yield=!0),!u&&(s.yield||n>=s.time)||e){if(u||(c._insert(c.task=s,!0),s.yield=!0,s.heap=h),e)return u&&!s.canceled&&(s.started=!1,s.onDone&&s.onDone(h)),c._resume();r=!0;break}r||(s.yield=!1,s.heap=null,s.canceled||(s.started=!1,s.onDone&&s.onDone(h)))}if(!l)return c._resume();c.active=!1}else c._resume()},t.prototype.setExclusiveTime=function(t){this.time=0^t},t.prototype._next=function(){var t,n=this,r=n.queue,i=r[0][0],o=n.now();if(i&&o>=i.delayed)return n._delayed&&e.clearTimeout(n._delayed),n.queue[0].shift();for(var a=1,s=r.length;a<s;a++)if(t=r[a].shift())return t;i&&(n._delayed&&e.clearTimeout(n._delayed),n._delayed=e.setTimeout((function(){n._delayed=null,n.active=!0,n.runner()}),i.delayed-o))},t.prototype.create=function(t){return new r(this,t.priority,t.exec,t.init,t.time,t.onDone,t.name,t.delay)},t.prototype._insert=function(t,e){var n;if(t.delay){t.delayed=this.now()+t.delay;for(var r=0,i=(n=this.queue[0]).length-1,o=void 0;r<=i;)if(n[o=(r+i)/2|0].delayed>t.delayed)i=o-1;else if(r=o+1,n[o].delayed==t.delayed)break;n.splice(r,0,t)}else n=this.queue[t.priority],e?n.unshift(t):n.push(t)},t.prototype.isWaiting=function(t){return-1!=this.queue[t.delay?0:t.priority].indexOf(t)},t.prototype.start=function(t,e){var n=this.task;t.started||t.paused||(t.started=!0,t!=n&&(t.canceled=!1,this._insert(t),this.active?n&&n.priority>t.priority&&(n.yield=!0):(this.active=!!e,this.runner())))},t.prototype.cancel=function(t){t.canceled=!0,t.yield=!1,t.started=!1;var e=t==this.task,n=t.delay?0:t.priority,r=this.queue[n],i=r.indexOf(t);return-1!=i&&r.splice(i,1),e&&(this.task=null),e},t}(),h={getInstance:function(t){return i?"number"==typeof t&&(i.time=t):i=this.createInstance(t),i},createInstance:function(t){return this.active=!0,new u(t)},active:!1},c=function(t,e,n){for(var r=-1,i=0;i<t.length;i++)if(t[i][0]==e&&t[i][1]==n){r=i;break}return r},l=function(){function t(t){this._l={},this._sync=!1,this._exec={};for(var e=0;e<t.length;e++)this.addEvent(t[e])}return t.prototype.addEvent=function(t){this._l[t]||(this._l[t]=[],this._exec[t]=o)},t.prototype.sync=function(t){return this._sync=!!t,this},t.prototype.removeEvent=function(t){delete this._l[t]},t.prototype.getEvents=function(){var t=[];for(var e in this._l)t[t.length]=e;return t},t.prototype.get=function(t){var e=this._l[t];return e&&e.slice()},t.prototype.isDefined=function(t){return!!this._l[t]},t.prototype.isListened=function(t){return this._l[t]&&this._l[t].length},t.prototype.add=function(t,e,n){var r=!1;return this._l.hasOwnProperty(t)&&-1==c(this._l[t],e,n)&&(this._l[t].push([e,n]),r=!0),r},t.prototype.remove=function(t,e,n){if(this._l.hasOwnProperty(t)){var r=c(this._l[t],e,n);if(-1!=r)return this._exec[t]--,this._l[t].splice(r,1),!0}return!1},t.prototype.trigger=function(t,e,n,r){var i,a=!1;if(this._l[t]){var s=this._l[t].length;for(this._exec[t]=0;this._exec[t]<s;this._exec[t]++)if(a=!0,i=this._l[t][this._exec[t]]){if(r&&!r(i))continue;var u=i[0],h=i[1];n||this._sync?Array.isArray(e)?u.apply(h,e):u.call(h,e):function(t,e,n){setTimeout((function(){Array.isArray(n)?t.apply(e,n):t.call(e,n)}),0)}(u,h,e)}this._exec[t]=o}return a},t}(),p=function(t,e){this.key=t,this.data=e};p.prototype.data=null,p.prototype.next=null,p.prototype.prev=null;var f,y=function(){function t(t){this.length=0,this.head=null,this.tail=null,this.max=t||5e3,this._={},this.tail=null}return t.prototype.setSize=function(t){if(this.length>t)for(var e=this.length-t;e--;)this.remove(this.tail.key);this.max=t},t.prototype.get=function(t){var e,n,r;return(e=this._[t])&&(e!=this.head&&(this.tail==e&&(this.tail=e.next),n=e.prev,r=e.next,n&&(n.next=e.next||e),r&&(r.prev=n),(n=this.head)&&(n.next=e),e.prev=this.head,e.next=null,this.head=e),e=e.data),e},t.prototype.toArray=function(){for(var t=[],e=this.tail,n=0;e;)t[n++]=e.data,e=e.next;return t},t.prototype.forEach=function(t){for(var e=this.tail,n=0;e;)t(e.data,n++),e=e.next},t.prototype.clear=function(){this._={},this.head=null,this.tail=null,this.length=0},t.prototype.remove=function(t){var e,n,r;return(e=this._[t])&&(n=e.prev,r=e.next,n&&(n.next=r),r&&(r.prev=n),r||(this.head=n),n||(this.tail=r),delete this._[t],e=e.data,this.length--),e},t.prototype.set=function(t,e){var n,r,i;return(n=this._[t])?(n.data=e,n!=this.head&&this.get(t)):(this.length==this.max?(i=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,n=new p(t,e),this._[t]=n,(r=this.head)?(n.prev=r,r.next=n):this.tail=n,this.head=n),i},t}(),d=h.getInstance(13),v=function(t,e,n){n=n||d;var r=t.indexOf("["),i=t.lastIndexOf("]"),o=function(e,n){e.grp=20,e.elements.push.apply(e.elements,JSON.parse("["+t.slice(e.start,n)+"]")),e.start=null};n.create({name:"PJA",priority:4,time:4,onDone:function(n){if(e){var o=void 0,a=n.elements;if(a.length)if(-1!=t.indexOf('"type":"FeatureCollection"')){var s=JSON.parse(t.substr(0,r+1)+t.substr(i));s.features=a,o=s}else o=a;else o=JSON.parse(t);e(o)}},init:function(){return{i:r,open:0,start:null,len:i,elements:[],grp:20,last:null}},exec:function(e){var n,r,i=e.elements,a=e.len;if(e.i<a){for(;(n=e.i++)<a;)if('"'!=(r=t.charAt(n))){if("{"==r)e.open++,null==e.start&&(e.start=n);else if("}"==r){if(0==--e.open)return--e.grp&&n<a-2||(e.grp=20,i.push.apply(i,JSON.parse("["+t.slice(e.start,e.last=n+1)+"]")),e.start=null),this.CONTINUE}else if(0==e.open&&!isNaN(r)){20!=e.grp&&o(e,n-1);var s=t.substr(n),u=s.search("[0-9](]|,)")+1;i.push(parseFloat(s.substring(0,u))),e.i=n+u}}else e.i=t.indexOf('"',n+1)+1;20!=e.grp&&null!=e.last&&i.push.apply(i,JSON.parse("["+t.slice(e.last+1,t.lastIndexOf("]"))+"]"))}}}).start()},_=function(t,e,n){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);for(var r in e=e||new n.constructor,n)e[r]=_(t,t?e[r]:null,n[r]);return e},g=function(t,e){for(var n in e)"constructor"!=n&&(t[n]=e[n]);return t},m=function(t){var e,n;if("object"!=typeof t)return t;if(!t)return t;if("[object Array]"===Object.prototype.toString.apply(t)){for(e=[],n=0;n<t.length;n+=1)e[n]=m(t[n]);return e}for(n in e={},t)t.hasOwnProperty(n)&&(e[n]=m(t[n]));return e},M={loglevel:"debug",dump:function(t,e){var n=!!M.loglevel,r=Array.prototype.slice.call(arguments),i=r[r.length-1],o=window.console;if(n&&o&&(i in o?r.pop():i="log",!0===n||n===i))if(Function.prototype.bind&&"object"==typeof o.log){var a=Function.prototype.bind.call(o[i],o);a.apply(o,r)}else o[i].apply(o,r);return M},extend:function(t,e,n){return"boolean"!=typeof t&&(n=e,e=t,t=!1),_(t,e,n)},clone:m,createObject:Object.create||function(t){var e=function(){};return e.prototype=t,new e},inheritClass:function(t,e,n){var r=e.prototype,i=t.prototype;for(var o in"object"==typeof e&&(n=e,e.constructor==Object.prototype.constructor&&(e.constructor=function(){t.apply(this,arguments)}),e=e.constructor),e.prototype=M.createObject(i),r&&r!=Object.prototype&&g(e.prototype,r),t)e[o]=t[o];return n&&g(e.prototype,n),e},isFunction:function(t){return"function"==typeof t},isNumeric:function(t){return!isNaN(+t)&&isFinite(t)},isPlainObject:function(t){if(!t||"object"!=typeof t||t.nodeType||t==t.window)return!1;try{if(t.constructor&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(t){return!1}var e;for(e in t);return undefined===e||t.hasOwnProperty(e)},String:{round:function(t,e){return e?Number(t.toFixed(e)):Math.round(t)},random:function(t){t=t||16;for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",r=n.length,i=0;i<t;i++)e+=n.charAt(Math.random()*r^0);return e}}},x=Math.PI/180,b=180/Math.PI,O=6371e3,w={calcBearing:function(t,e){var n,r,i,o,a;return n=Math.PI/180,r=t[1]*n,i=e[1]*n,o=t[0]*n,a=e[0]*n,(Math.atan2(Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(a-o),Math.sin(a-o)*Math.cos(i))/n+360)%360},movePoint:function(t,e,n,r){var i=e/(r=r===f?O:r),o=n*x,a=t[1]*x,s=t[0]*x,u=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(o)),h=s+Math.atan2(Math.sin(o)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(u));return[(h=(h+3*Math.PI)%(2*Math.PI)-Math.PI)*b,u*b]},getPointBBox:function(t,e){var n=t[1],r=t[0],i=Math.asin(e/(O*Math.cos(Math.PI*n/180)))*b,o=Math.asin(e/O)*b;return[r-i,n-o,r+i,n+o]},mergeBBoxes:function(t,e){return t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t},extendBBox:function(t,e){var n=Math.abs(Math.asin(e/(O*Math.cos(t[0]*x))))*b,r=Math.abs(Math.asin(e/(O*Math.cos(t[2]*x))))*b,i=Math.abs(Math.asin(e/O))*b;return[t[0]-n,t[1]-i,t[2]+r,t[3]+i]},distance:function(t,e){var n=x*(e[1]-t[1]),r=x*(e[0]-t[0]),i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(x*t[1])*Math.cos(x*e[1])*Math.sin(r/2)*Math.sin(r/2),o=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),a=O*o;if(t[2]!=f&&e[2]!=f){var s=t[2]-e[2];a=Math.sqrt(a*a+s*s)}return a}},N={centroid:function(t){for(var e,n,r=t[0],i=r[0][0],o=r[0][1],a=0,s=0,u=0,h=0,c=r.length,l=c-1,p=void 0,f=void 0,y=void 0;h<c;l=h,h++)e=r[h][0]-i,n=r[h][1]-o,s+=(e+(p=r[l][0]-i))*(y=n*p-(f=r[l][1]-o)*e),u+=(n+f)*y,a+=y;return(a*=3)?[s/a+i,u/a+o]:[e,n]}},P=function(){function t(t){if(this.size=0,this._=[],t)for(var e=0;e<t.length;e++)this.add(t[e])}return t.prototype.add=function(t){var e=!this.has(t);return e&&(this.size=this._.push(t)),e},t.prototype.clear=function(){this.size=this._.length=0},t.prototype.delete=function(t){var e=this._.indexOf(t),n=-1!=e;return n&&(this._.splice(e,1),this.size--),n},t.prototype.has=function(t){return-1!=this._.indexOf(t)},t.prototype.toArray=function(){return this._.slice(0)},t}(),j=function(){function t(t){if(this._={},this.size=0,t)for(var e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}return t.prototype.clear=function(){this.size=0,this._={}},t.prototype.delete=function(t){var e=this.has(t);return e&&(delete this._[t],this.size--),e},t.prototype.get=function(t){return this._[t]},t.prototype.has=function(t){return null!=this._[t]},t.prototype.set=function(t,e){var n=!this.has(t);return n&&(this.size++,this._[t]=e),n},t.prototype.values=function(){var t=this._,e=[];for(var n in t)e[e.length]=t[n];return e},t.prototype.keys=function(){var t=this._,e=[];for(var n in t)e[e.length]=n;return e},t.prototype.forEach=function(t){var e=this._;for(var n in e)t(e[n],n,this)},t}(),z=function(){function t(){this.queue=[]}return t.prototype.add=function(t){if("function"==typeof t)return this.queue.push(t)},t.prototype.done=function(t,e,n){for(var r=this.queue;r.length;)r.shift().apply(void 0,arguments)},t}(),k=Object.freeze({__proto__:null,sub:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},multiply:function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},length:function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},normalize:function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},cross:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},transform:function(t,e,n){var r=e[0],i=e[1],o=e[2]||0,a=n[3]*r+n[7]*i+n[11]*o+n[15];return a||(a=1),t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}}),E=e;"here.xyz.maps".split(".").forEach((function(t){return E=E[t]=E[t]||{}})),e.HERE=e.here;var I={LRU:y,TaskManager:h,Listener:l,parseJSONArray:v,JSUtils:M,geotools:w,global:e,Queue:z,Set:P,Map:j,vec3:k,geometry:N};E.common=I,t.JSUtils=M,t.LRU=y,t.Listener=l,t.Map=j,t.Queue=z,t.Set=P,t.Task=r,t.TaskManager=h,t.default=I,t.geometry=N,t.geotools=w,t.global=e,t.parseJSONArray=v,t.vec3=k,Object.defineProperty(t,"__esModule",{value:!0})}));
